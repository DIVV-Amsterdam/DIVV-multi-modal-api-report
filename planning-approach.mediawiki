==Planning Approach==

During our experiment we found that there are several formats for representing a single journey in the field.  for instance when querying google maps it will return a ROUTE which consists of a set of LEGS each with STEPS whereas other systems represent the same journey differently.  However The basic contruction of breaking the journey down into smaller parts is common accross all systems.

In the scenarios that we created for this project we defined 2 additional types of data format.  One representing a STOPOVER and one representing a MULTIMODALHUB.  Since one of the use cases we defined for our study was a person undertaking multiple journeys but with some sort of appointment to be held between each journey we invented the STOPOVER which has a ''location'' and an ''duration'' but acts as a sort of 'glue' to indicate that several journeys are connected as opposed to independent.  The MULTIMODALHUB was created because we came to the conclusion that it would be necessary to have a reccommended set of points where switching between modes of transport should be performed.

STOPOVER
# Always has a duration
# Can have either one or two locations. <br>To elaborate, the appointment that a person has may end up with them moving independently within a certain area.  For instance going to the Rijksmuseum to meet a friend and then having lunch together on Leisdeplein.  In this case there are 2 journeys one ending at the Rijksmuseum and one starting 3 hours later at Leisdeplein.

MULTIMODALHUB
# Has an ID
# Has a name
# Has one geo location
# Has many references to nodes (bus stops, train stations, parking garages, bike storage, Tram stops, Ferry terminals etc..)

For the purposes of the project we were tasked with attempting to make a multi-modal travel API using all available technical resources and documenting our findings.  Therefore our goal was not to make a final working API.  Bearing this in mind we decided to set up Park and Ride (P+R) locations as MILTIMODAL hubs.  The whole reason for creating this node type was to reflect the reality that although you could use almost any location to switch from car to public transport by using on street parking, that it is not desirable for the city of Amsterdam to have people planning to leave their cars all over the city and then switching on to the tram or bus network.  The facts are quite different and there are a number of specially created places for people to switch from one mode of transport to another including but not exclusively P+R.  Schiphol is also an example from Train to Bus, and Buijmer Arena.

MULTI STAGE PLANNING
In the use cases used in this project there are two distinct phases of planning which we seperated.
# Phase 1 - reccommendation of routes, also called route planning.<br> This takes as its input your starting and ending dstination and variables such as departure or arrival time and desired methods of transport, and caclulates one or multiple travel options.
# Phase 2 - realtime monitoring<br>In this phase a specified journey is augmented with real time updates in order to see whether the journey is still viable or whether analternative route needs to be planned.
It is possible that when planning a journey with an immeduate departure that Phase1 and Phase2 are some simutaniuosly but in many cases it is necessary to have the two phases seperated.  Both Phase1 and Phase2 need to hold journeys with segments accros multiple modes of transport and in this case both the planning phase and the real time phase will need to hold segments from different planning real time datasets.  For instance segment 1 Car from Utrecht to P+R, segment 2 tram from P+R to central station, segment 3 tram from central station to westerpark, segment 4 walking from westerpark to a street address.  In this case it is impossible to use one planning system for all 4 segments and therefore in this example segment 1 may be planned using google maps , segment 2 and 3 by OV9292, and segment 4 by open street maps.

In order for this to work we need our own data format to represent a journey, coming from the result of the planning phase.  We did not want to 're-invent the wheel' and therefore for the project we adopted a model form opentripplanner.org which caters for this type of multi stage, multi modal journey.  In this case we have added to it the additional node types we needed.

Details of the model can be found at http://www.opentripplanner.org/apidoc/model.html.  At the moment it seems comprehensive enough for our needs and also has the possiblilty to identify a different agency which is synonimous with for instance GVB for each stage and therefore we can adapt this concept.

In simple form we are using :

Journey 
  - from
  - to
  - options
  - Leg(s) (one segment by one mode of transport and route)
    - Step(s) (Breakdown of Leg into smaller parts)

If I give some illustative examples :

Walking and driving legs will most likely involve many steps e.g. 100m turn left, 300m turn right etc...
Public Stransport leg will most likely involve one step e.g. Tram 5 from tram stop A to tram stop B

The data model used by opentripplanner is very handy for this and has the following usefull elements which we will use :

- A stop with an ID with an agency e.g. 
    Name : "Nieuwmarkt", 
    Agency : "GVB", 
    ID : "GVB|09503", 
    lon 4.90124, 
    lat : 52.37194

- A Leg with many usefull elements e.g.
    routeLongName : "Westwijk - Centraal Station"
    routeShortName : "51"
    tripId : "36|GVB|51|W|WE|51|18689"
    agencyId : "GVB" 
    headsign : "Westwijk" 
    tripShortName : "18689" 
    routeId : "GVB|51" 
    agencyTimeZoneOffset : "0" 
    agencyUrl : "http://www.gvb.nl/" 
    agencyName : "GVB" 
    route : "51" 
    mode : "SUBWAY"

- A step with a type and many usefull elements e.g.
    walkSteps
      distance : 2.018264866091147
      streetName : Rapenburg
      absoluteDirection : SOUTHEAST
      stayOn : false
      area : false
      bogusName : false
      lon : 4.907750131937921
      lat : 52.371710127572086
      elevation : 0
      tooSloped : false


- A set of modes, currently defined are :
    WALK	
    BICYCLE	
    CAR	
    TRAM	
    SUBWAY	
    RAIL	
    BUS	
    FERRY	
    CABLE_CAR	
    GONDOLA	
    FUNICULAR	
    TRANSIT	
    TRAINISH	
    BUSISH	
    BOARDING	
    ALIGHTING	
    TRANSFER	
    STL	


PLANNING WITH MULTIPLE SYSTEMS
For Amsterdam there is no one system that can plan all methods of transport that we want and with the addition of MULTIMODALTRANSITHUB(s) and STOPOVER(s).  Therefore the multi modal travel API would have to take a journey and request the parts from several external planning engines and then hold these like a sort of super planner.  Therefore a planning system may look a little like :

Journey from address in Utrecht to address in Amsterdam may look like this :

    from : address in utrecht
    to : address in amsterdam
        leg 1
          from : address in utrecht to amsterdam P+R
          to : MULTIMODALHUB P+R Arena
          mode : PRIVATEAUTO
          plannedby : google maps
          planningData : (data from google maps)
          departure : 09:00, tue 10 feb
          arrival : 09:45 , tue 10 feb
          realtimedata : tomtom
        leg 2
          from : MULTIMODALHUB P+R Arena
          to : Amstel Train Station
          mode : TRAIN
          plannedby : NS
          planningData : (data from ns)
          departure : 10:06, tue 10 feb
          arrival : 10:15 , tue 10 feb
          realtimedata : ns
        leg 3
          from : Amstel Train Station
          to : Tramstop weteringcircuit
          mode : TRAM / TRAM 24
          plannedby : OV9292
          planningData : (data from ov9292)
          departure : 10:25, tue 10 feb
          arrival : 10:40 , tue 10 feb
          realtimedata : ov9292-rt-system
        leg 4
          from : Tramstop weteringcircuit
          to : Tramstop Leidseplein
          mode : TRAM / TRAM 7
          plannedby : OV9292
          planningData : (data from ov9292)
          departure : 10:55, tue 10 feb
          arrival : 11:00 , tue 10 feb
          realtimedata : ov9292-rt-system
        leg 5
          from : Tramstop weteringcircuit
          to : address in Amsterdam
          mode : WALKING
          departure : 11:00, tue 10 feb
          arrival : 11:10 , tue 10 feb
          realtimedata : not possible

In the above example leg 3 and leg 4 probably came from one request to OV9292 but in order for real time updates to work they have been saved seperately.  Therefore the results coming back from any planning system will need to be interpreted and split out into steps which conform to the data model we have defined.  I want to emphasize this because treating the output from each planning system as a complete 'black box' is not sufficient.

Therefore I will explain how each of the planning system gives its results and how, in theory , we will interpret and convert these.


<table>
<tr>
<th>Planning system</th>
<th>Based on data</th>
<th>Covers</th>
</tr>
<tr>
<td>Google Maps</td>
<td>Googe Map Data</td>
<td>Driving, Walking, Bike, Transit</td>
</tr>
<tr>
<td>OpenTripPlanner</td>
<td>OpenStreetMap</td>
<td>Driving, Walking, Tram , Bus, Metro</td>
</tr>
<tr>
<td>OV9292</td>
<td>Combination of feeds</td>
<td>Walking, Train, Tram , Bus, Metro</td>
</tr>
<tr>
<td>NS</td>
<td>Own NS Data</td>
<td>Train</td>
</tr>
</table>

==Google maps==
  example
  from Overdiemerweg 12-13, 1111 Diemen, The Netherlands
  from 52.339633,4.998495
  to Hobbemastraat 16, 1071 ZB Amsterdam, The Netherlands
  to 52.359798,4.884206

WALKING

  http://maps.googleapis.com/maps/api/directions/json?mode=walking&origin=52.339633,4.998495&destination=52.359798,4.884206&sensor=true
  
  This returns directions in the following format
  
  ONE LEG
  MANY STEPS

DRIVING

  http://maps.googleapis.com/maps/api/directions/json?mode=driving&origin=52.339633,4.998495&destination=52.359798,4.884206&sensor=true
  
  This returns directions in the following format
  
  ONE LEG
  MANY STEPS

TRANSIT

  http://maps.googleapis.com/maps/api/directions/json?mode=transit&origin=52.339633,4.998495&destination=52.359798,4.884206&departure_time=1357901162&sensor=true
  (note use http://www.epochconverter.com to get the departute_time
  
  This returns the following
  
  ONE LEG
  STEP 1 (walking)
  - MANY STEPS within STEP 1
  STEP 2 (transit - tram to Central Station)
  - TRANSIT DETAILS within STEP 2 (including the agency GVB and tram line number)
  STEP 3 (walking)
  - MANY STEPS withing STEP 3
  STEP 4 (transit - Tram towards Van Hallstraat)
  - TRANSIT DETAILS within STEP 4 (including the agency GVB and tram line number)
  STEP 5 (walking)
  - MANY STEPS withing STEP 5




Same Journey, 3 results

<table>
<tr><td>Google</td><td>Walk 33 mins (2.7km)</td><td>Tram 9 (17 mins)</td><td>Tram 10 (9 mins)</td><td>Walk 6 mins</td></tr>
<tr><td>9292</td><td>Walk 19 mins</td><td>Bus 66</td><td>Walk 3 mins</td><td>NS to Buimer Arena</td><td>Walk 3 mins</td><td>Metro 50</td><td>Walk 3 mins</td><td>Bus 170</td><td>Walk 1 min</td></tr>
<tr><td>Opentripplanner</td><td>Walk 28 mins</td><td>Bus 44</td><td>Sprinter to CS</td><td>Tram 7</td><td>Walk 7 mins</td></tr>
</table>
Google :
